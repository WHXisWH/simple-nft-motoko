# File NFT Canister

このプロジェクトは、Internet Computer上でファイルをアップロードしNFT化できるcanisterを実装したものです。ファイルを分割アップロードし、NFTとして管理することができます。

## デプロイ済みCanister

- Canister ID: `omnp4-sqaaa-aaaab-qab7q-cai`
- 環境: IC Playground

## キャニスターの動作説明

このキャニスターは以下の主要なコンポーネントで構成されています：

1. **ストレージ管理**
   - NFTデータの保存
   - アップロードされたファイルのチャンク管理
   - 所有者情報の追跡

2. **メイン機能**
   - NFTの作成と管理
   - ファイルの分割アップロード
   - データの取得と検証

### 内部動作フロー

1. **ファイルアップロード時**:
   ```
   [ファイル] → [チャンク分割] → [uploadChunk関数] → [一時保存] → [mintWithAsset関数] → [NFT作成]
   ```

2. **NFT作成時**:
   ```
   [メタデータ] → [mint関数] → [所有者登録] → [NFTデータ保存] → [TokenID返却]
   ```

3. **データ取得時**:
   ```
   [TokenID] → [getXXX関数] → [データ検証] → [結果返却]
   ```

## Playground での動作確認手順

### 1. NFTの基本作成（ファイルなし）

![NFT作成手順]

1. Candid UIにアクセス
   - `mint`関数を選択
   - メタデータを入力（例: "My First NFT"）
   - [Call]ボタンをクリック
   - 返却されたTokenIDを記録

### 2. ファイル付きNFTの作成

![ファイルアップロード手順]

1. ファイルのアップロード
   ```
   uploadChunk関数:
   - 入力: バイナリデータ (vec nat8)
   - 出力: チャンクID (nat)
   ```

2. NFTの作成
   ```
   mintWithAsset関数:
   - 入力1: メタデータ (text)
   - 入力2: コンテンツタイプ (text)
   - 出力: TokenID (nat)
   ```

### 3. NFT情報の確認

![情報確認手順]

1. 所有者の確認
   ```
   getOwner関数:
   - 入力: TokenID
   - 出力: Principal ID
   ```

2. メタデータの確認
   ```
   getMetadata関数:
   - 入力: TokenID
   - 出力: メタデータ情報
   ```

3. アセット情報の確認
   ```
   getAsset関数:
   - 入力: TokenID
   - 出力: {contentType, chunks}
   ```

## エラー対処方法

1. **アップロード失敗時**
   - チャンクサイズが2MB以下であることを確認
   - 一度に1チャンクずつアップロード

2. **NFT作成エラー**
   - Principal IDが正しいことを確認
   - メタデータが空でないことを確認

3. **データ取得エラー**
   - TokenIDの存在確認
   - クエリ呼び出しの制限確認

## 制限事項とベストプラクティス

1. **アップロード制限**
   - 最大チャンクサイズ: 2MB
   - 推奨チャンク数: 50以下/NFT

2. **実行制限**
   - クエリ呼び出し: 即時実行
   - アップデート呼び出し: 数秒の遅延

3. **ストレージ制限**
   - キャニスターサイズ制限に注意
   - 大きなファイルは分割推奨

## 開発環境のセットアップ

```bash
# リポジトリのクローン
git clone [リポジトリURL]
cd file_nft

# 依存関係のインストール
npm install

# ローカル実行
dfx start --clean --background
dfx deploy
```

## ライセンス

MIT License

## 貢献ガイドライン

1. Issue作成
2. ブランチ作成
3. 変更実装
4. テスト実行
5. プルリクエスト作成